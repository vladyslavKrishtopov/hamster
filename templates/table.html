<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventory Table</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* vertically center all table cells */
    table th, table td { vertical-align: middle; }

    /* minimalist chevron: use SVG, larger and smoothly animated around its center */
    .chev { display:block; width:36px; height:18px; transition: transform .28s cubic-bezier(.2,.8,.2,1), fill .12s ease-in-out; transform-origin: center; transform-box: fill-box; }
    /* rotate when the toggle button has aria-expanded=true */
    button[aria-expanded="true"] .chev { transform: rotate(90deg); }
    button:hover .chev { fill: #0d6efd; }
  </style>
</head>
<body class="bg-white">
  <div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h4">Inventory</h1>
      <div>
        <a href="/logout" class="btn btn-outline-secondary btn-sm">Logout</a>
      </div>
    </div>

    <div class="mb-3 d-flex gap-2 flex-nowrap">
      <input id="q" class="form-control flex-grow-1" placeholder="Search by name or SKU">
      <a href="/items/new" class="btn btn-primary flex-shrink-0">Add item</a>
    </div>

    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th></th>
          <th>SKU</th>
          <th>Name</th>
          <th>Qty</th>
          <th>Location</th>
          <th>Category</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="items">
        {% if items %}
          {% for item in items %}
            <tr>
              <td class="p-0" style="width:72px">
                <button class="btn btn-sm btn-link text-secondary p-0 d-flex align-items-center justify-content-center" data-bs-toggle="collapse" data-bs-target="#details-{{ loop.index0 }}" aria-expanded="false" aria-controls="details-{{ loop.index0 }}" aria-label="Toggle details for {{ item.name }}">
                  <svg class="chev" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor" aria-hidden="true">
                    <path d="M6 3l5 5-5 5V3z" />
                  </svg>
                </button>
              </td>
              <td>{{ item.sku }}</td>
              <td>{{ item.name }}</td>
              <td>{{ item.qty }}</td>
              <td>{{ item.location }}</td>
              <td>{{ item.category }}</td>
              <td>
                <a href="{{ url_for('edit_item', item_id=item.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                <form action="{{ url_for('delete_item', item_id=item.id) }}" method="post" style="display:inline" onsubmit="return confirm('Delete item {{ item.name }} ({{ item.sku }})?')">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
              </td>
            </tr>
            <tr class="collapse" id="details-{{ loop.index0 }}">
              <td colspan="7" class="bg-light small">
                  <div class="p-3">
                    <strong>Description:</strong>
                    <div class="text-muted">{{ item.description or '—' }}</div>
                    <div class="row mt-2">
                      <div class="col-md-4"><strong>Location:</strong> {{ item.location or '—' }}</div>
                      <div class="col-md-4"><strong>Category:</strong> {{ item.category or '—' }}</div>
                      <div class="col-md-4"><strong>Quantity:</strong> {{ item.qty }}</div>
                    </div>
                    <div class="row mt-2">
                      <div class="col-md-4"><strong>Purchase price:</strong>
                        {% if item.purchase_price is defined %}
                          ${{ '%.2f'|format(item.purchase_price) }}
                        {% else %}
                          —
                        {% endif %}
                      </div>
                    </div>
                  </div>
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="7" class="text-muted">No items yet — add one.</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // small client-side search for preview only
    const q = document.getElementById('q');
    const rows = Array.from(document.querySelectorAll('#items tr'));
    q.addEventListener('input', () => {
      const term = q.value.trim().toLowerCase();
      rows.forEach(r => {
        r.style.display = r.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    });
  </script>
</body>
</html>
